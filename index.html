<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Routine & Habit Reminder (AMOLED)</title>
  <meta name="theme-color" content="#000000" id="themeMeta">
  <link rel="stylesheet" href="mobile.css">
  <style>
    /* AMOLED theme variables */
    :root{
      --bg: #000000;
      --panel: rgba(255,255,255,0.03);
      --muted: #7f8c93;
      --accent: #00f5a0; /* neon green */
      --accent-2: #00b7ff; /* neon blue */
      --good: #22c55e;
      --card-radius: 14px;
      --text: #e6eef6;
    }

    /* base */
    *{box-sizing:border-box;font-family:Inter,system-ui,'Segoe UI',Arial,sans-serif}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--text)}
    body{display:flex;align-items:flex-start;justify-content:center;padding:18px}
    .app{width:100%;max-width:1100px}

    /* header */
    header{display:flex;align-items:center;gap:12px;margin-bottom:18px}
    /*.logo{width:64px;height:64px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;font-weight:800;color:#001018;font-size:20px}
    
    */
    .logo {
  width: 64px;
  height: 64px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  /* Remove the gradient */
  background: url('my-logo.png') no-repeat center center;
  background-size: cover; /* Make the image fill the container */
  font-weight: 800;
  color: transparent; /* Hide the text inside if any */
  font-size: 20px;
}

    
    h1{font-size:20px;margin:0}
    p.lead{margin:0;color:var(--muted);font-size:13px}

    /* tabs */
    .tabs{display:flex;gap:8px;margin-bottom:12px}
    .tab{padding:8px 12px;border-radius:10px;background:transparent;cursor:pointer;color:var(--muted);font-weight:700;border:1px solid rgba(255,255,255,0.02)}
    .tab.active{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#001018;box-shadow:0 8px 28px rgba(0,183,255,0.06)}

    /* grid */
    .grid{display:grid;grid-template-columns:1fr 380px;gap:16px}
    @media(max-width:980px){.grid{grid-template-columns:1fr}.sidebar{order:2}}

    /* card */
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:14px;border-radius:var(--card-radius);box-shadow:0 10px 40px rgba(0,0,0,0.6)}
    .small{font-size:13px;color:var(--muted)}

    /* lists */
    .routines{display:flex;flex-direction:column;gap:12px}
    .routine{display:flex;align-items:center;gap:12px;padding:12px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.015), transparent);border:1px solid rgba(255,255,255,0.02)}
    .time{min-width:72px;text-align:center;font-weight:800;color:var(--accent-2)}
    .meta{flex:1}
    .tags{color:var(--muted);font-size:12px}

    /* controls */
    button,.btn{cursor:pointer;border:0;padding:8px 12px;border-radius:10px;background:transparent;color:var(--accent);font-weight:700}
    .btn.primary{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#001018;box-shadow:0 10px 30px rgba(0,183,255,0.06)}
    input,select,textarea{padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.02);background:transparent;color:var(--text);width:100%}
    .controls{display:flex;gap:8px}

    /* habit */
    .habit{display:flex;align-items:center;justify-content:space-between;padding:8px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent)}
    .progress{height:10px;background:rgba(255,255,255,0.02);border-radius:10px;overflow:hidden}
    .progress>i{display:block;height:100%;background:linear-gradient(90deg,var(--good),var(--accent-2))}

    /* chart */
    canvas#chart{width:100%;height:120px;background:transparent}

    /* confetti overlay */
    .confetti-canvas{position:fixed;left:0;top:0;pointer-events:none;z-index:9999}

    /* summary layout */
    .summary-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media(max-width:700px){.summary-grid{grid-template-columns:1fr}}

    .pill{display:inline-block;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,0.02);font-weight:700;color:var(--muted)}
    .empty{padding:18px;border-radius:8px;background:rgba(255,255,255,0.01);text-align:center;color:var(--muted)}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="logo">Daily</div>
      <div style="flex:1">
        <h1>Routine & Habit Reminder</h1>
        <p class="lead">AMOLED â€¢ 24-hour time â€¢ Local-first</p>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <button class="btn" id="soundUnlockBtn">Enable Sound</button>
        <button class="btn" id="installBtn" style="display:none">Install</button>
      </div>
    </header>

    <div class="tabs">
      <div class="tab active" data-tab="home">Home</div>
      <div class="tab" data-tab="summary">Daily Summary</div>
      <div style="margin-left:auto" class="small">Local time: <span id="now">--:--</span></div>
    </div>

    <div class="grid">
      <!-- Main -->
      <main>
        <div id="homePage">
          <div class="card">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
              <div>
                <strong>Today's Routines</strong>
                <div class="small">Check off tasks as you complete them â€” we'll remind you.</div>
              </div>
              <div style="display:flex;gap:8px;align-items:center">
                <button class="btn" id="addRoutineBtn">+ Quick add</button>
                <button class="btn" id="clearDoneBtn">Clear completed</button>
              </div>
            </div>

            <div id="routines" class="routines"></div>

            <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
              <button class="btn" id="exportBtn">Export</button>
              <button class="btn" id="importBtn">Import</button>
              <button class="btn" id="soundTest">Play sound</button>
            </div>
          </div>

          <div class="card" style="margin-top:12px">
            <strong>Habit Tracker</strong>
            <div class="small">Daily check-ins create streaks. Tap a habit to mark complete.</div>
            <div id="habits" style="margin-top:10px"></div>

            <div style="display:flex;gap:8px;margin-top:10px">
              <input id="newHabitInput" placeholder="Add habit (e.g. Read 20 min)" />
              <input id="habitReminderTime" type="time" title="Set a daily reminder time (optional)" style="width:130px" />
              <button class="btn primary" id="addHabitBtn">Add</button>
            </div>
          </div>
        </div>

        <!-- Summary -->
        <div id="summaryPage" style="display:none">
          <div class="card">
            <strong>Daily Summary â€” <span id="summaryDate"></span></strong>
            <div class="small" style="margin-top:6px">Overview of today's routines & habits</div>

            <div style="margin-top:12px" class="summary-grid">
              <div class="card" style="padding:12px;">
                <h4 style="margin:6px 0">Completed Routines</h4>
                <ul id="summaryCompleted" style="margin:0 0 8px 18px;padding:0"></ul>
                <div class="small">Total: <span id="summaryCompletedCount">0</span></div>
              </div>

              <div class="card" style="padding:12px;">
                <h4 style="margin:6px 0">Missed Routines</h4>
                <ul id="summaryMissed" style="margin:0 0 8px 18px;padding:0"></ul>
                <div class="small">Total: <span id="summaryMissedCount">0</span></div>
              </div>

              <div class="card" style="padding:12px;grid-column:span 2">
                <h4 style="margin:6px 0">Habits Overview</h4>
                <div id="summaryHabits"></div>
              </div>
            </div>

            <div style="margin-top:12px;display:flex;justify-content:space-between;align-items:center">
              <div class="small">Data stored locally. Export on Home.</div>
              <div style="display:flex;gap:8px">
                <button class="btn" id="exportSummaryBtn">Export Summary</button>
                <button class="btn" id="backHomeBtn">Back</button>
              </div>
            </div>
          </div>
        </div>
      </main>

      <!-- Sidebar -->
      <aside class="sidebar">
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <strong>Quick Add Routine</strong>
            <div class="pill small" id="streakPill">Streak: 0</div>
          </div>

          <div class="small" style="margin-top:8px">Set a time and name â€” we'll notify when time comes.</div>
          <div style="display:grid;grid-template-columns:1fr 120px;gap:8px;margin-top:8px">
            <input id="routineName" placeholder="Routine name" />
            <input id="routineTime" type="time" />
          </div>
          <div style="margin-top:8px;display:flex;gap:8px">
            <select id="routineRepeat">
              <option value="daily">Daily</option>
              <option value="weekdays">Weekdays</option>
              <option value="once">Once</option>
            </select>
            <button class="btn primary" id="saveRoutine">Save</button>
          </div>

          <div style="margin-top:12px">
            <strong>Weekly Progress</strong>
            <canvas id="chart" width="360" height="120" style="margin-top:8px"></canvas>
            <div class="small" style="margin-top:6px">Bars = # habits completed each day</div>
          </div>

          <div style="margin-top:12px" class="small">Made with care â€” use [Daily] every day âœ¨</div>
        </div>
      </aside>
    </div>
  </div>

  <!-- embedded tiny valid WAVs (short) -->
  <audio id="audio-beep" preload="auto" src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YQAAAAA="></audio>
  <audio id="audio-chime" preload="auto" src="data:audio/wav;base64,UklGRhQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YQAAAAE="></audio>
  <audio id="audio-success" preload="auto" src="data:audio/wav;base64,UklGRlQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YQAAAAI="></audio>

  <canvas class="confetti-canvas" id="confetti" style="display:block"></canvas>

  <script>
  /* Single-file AMOLED Daily app */
  const LS_KEY = 'daily_amoled_v1';

  const defaultState = {
    routines: [
      { id: uid(), time: getTimePlusMinutes(1), name: 'Wake up', repeat: 'daily', done: false },
      { id: uid(), time: getTimePlusMinutes(2), name: 'Morning stretch', repeat: 'daily', done: false }
    ],
    habits: [],
    settings: { notifications: false, sound: 'chime' },
    meta: { lastDate: todayStr(), longestStreak: 0, weekly: {}, history: {} }
  };

  const soundMap = { beep: 'audio-beep', chime: 'audio-chime', success: 'audio-success' };

  let state = loadState();

  // helpers
  function uid(){ return Math.random().toString(36).slice(2,9); }
  function todayStr(){ return new Date().toISOString().slice(0,10); }
  function getTimePlusMinutes(minutes){
    const d = new Date();
    d.setMinutes(d.getMinutes() + (minutes||0));
    const hh = String(d.getHours()).padStart(2,'0');
    const mm = String(d.getMinutes()).padStart(2,'0');
    return `${hh}:${mm}`;
  }
  function loadState(){
    try{
      const raw = localStorage.getItem(LS_KEY);
      if(raw) return JSON.parse(raw);
    }catch(e){}
    localStorage.setItem(LS_KEY, JSON.stringify(defaultState));
    return JSON.parse(JSON.stringify(defaultState));
  }
  function saveState(){ localStorage.setItem(LS_KEY, JSON.stringify(state)); }

  // DOM refs
  const routinesEl = document.getElementById('routines');
  const habitsEl = document.getElementById('habits');
  const nowEl = document.getElementById('now');
  const summaryDateEl = document.getElementById('summaryDate');
  const quoteEl = document.getElementById('quote') || document.createElement('div');
  const chartCanvas = document.getElementById('chart');
  const longestEl = document.getElementById('streakPill');

  // clock
  function tickTime(){ const d=new Date(); nowEl.textContent = d.toTimeString().slice(0,5); }
  setInterval(tickTime,1000); tickTime();

  // render
  function render(){
    renderRoutines(); renderHabits(); renderSummaryPanel(); renderChart(); saveState();
  }

  function renderRoutines(){
    routinesEl.innerHTML = '';
    if(!state.routines.length){ routinesEl.innerHTML = '<div class="empty">No routines yet â€” add one on the right.</div>'; return; }
    state.routines.sort((a,b)=>a.time.localeCompare(b.time)).forEach(r=>{
      const el = document.createElement('div'); el.className='routine';
      el.innerHTML = `
        <div class="time">${r.time}</div>
        <div class="meta">
          <div style="display:flex;justify-content:space-between">
            <div style="font-weight:800">${escapeHtml(r.name)}</div>
            <div class="small tags">${r.repeat}</div>
          </div>
          <div class="small">${r.done ? 'Completed' : 'Pending'}</div>
        </div>
        <div class="controls">
          <button class="btn" data-id="${r.id}" data-action="toggle">${r.done ? 'Undo' : 'Done'}</button>
          <button class="btn" data-id="${r.id}" data-action="edit">Edit</button>
          <button class="btn" data-id="${r.id}" data-action="del">Del</button>
        </div>
      `;
      routinesEl.appendChild(el);
    });
  }

  function renderHabits(){
    habitsEl.innerHTML = '';
    if(!state.habits.length){ habitsEl.innerHTML = '<div class="empty">No habits yet â€” add one below.</div>'; return; }
    state.habits.forEach(h=>{
      const el = document.createElement('div'); el.className='habit card';
      el.innerHTML = `
        <div style="flex:1">
          <div style="font-weight:700">${escapeHtml(h.name)}</div>
          <div class="small">Streak: ${h.streak||0} â€¢ ${h.reminder?('Reminds at '+h.reminder):'No reminder'} â€¢ Done today: ${h.done?'Yes':'No'}</div>
        </div>
        <div style="width:150px;display:flex;flex-direction:column;gap:8px;align-items:center">
          <div class="progress" style="width:100%"><i style="width:${Math.min(100,(h.streak||0)/21*100)}%"></i></div>
          <div style="display:flex;gap:8px">
            <button class="btn" data-id="${h.id}" data-action="toggleHabit">${h.done ? 'Undo' : 'Check'}</button>
            <button class="btn" data-id="${h.id}" data-action="editHabit">Edit</button>
            <button class="btn" data-id="${h.id}" data-action="delHabit">Del</button>
          </div>
        </div>
      `;
      habitsEl.appendChild(el);
    });
  }

  function renderSummaryPanel(){
    const today = todayStr();
    document.getElementById('summaryDate').textContent = today;
    const todayDone = state.routines.filter(r=>r.done).length;
    const total = state.routines.length;
    document.getElementById('summaryCompletedCount').textContent = todayDone;
    document.getElementById('summaryMissedCount').textContent = total - todayDone;

    const compList = state.routines.filter(r=>r.done).map(r=>`<li>${escapeHtml(r.time)} â€” ${escapeHtml(r.name)}</li>`).join('') || '<li class="small">None</li>';
    const missList = state.routines.filter(r=>!r.done).map(r=>`<li>${escapeHtml(r.time)} â€” ${escapeHtml(r.name)}</li>`).join('') || '<li class="small">None</li>';
    document.getElementById('summaryCompleted').innerHTML = compList;
    document.getElementById('summaryMissed').innerHTML = missList;

    const habitsHTML = state.habits.map(h => `<div style="display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px dashed rgba(255,255,255,0.02)"><div><strong>${escapeHtml(h.name)}</strong><div class="small">${h.reminder?('Reminds '+h.reminder):'No reminder'}</div></div><div class="pill">${h.done ? 'Done' : 'Not yet'}</div></div>`).join('') || '<div class="small">No habits yet.</div>';
    document.getElementById('summaryHabits').innerHTML = habitsHTML;
    longestEl.textContent = 'Streak: ' + (state.meta.longestStreak || 0);
  }

  function renderChart(){
    const ctx = chartCanvas.getContext('2d');
    const today = new Date(); const days = [];
    for(let i=6;i>=0;i--){ const d=new Date(today); d.setDate(today.getDate()-i); days.push(d.toISOString().slice(0,10)); }
    const values = days.map(dd => state.meta.weekly[dd] || 0);
    ctx.clearRect(0,0,chartCanvas.width,chartCanvas.height);
    const w = chartCanvas.width; const h = chartCanvas.height;
    const barW = (w - 20) / values.length; const max = Math.max(1, ...values);
    ctx.fillStyle = 'rgba(255,255,255,0.02)'; ctx.fillRect(0,0,w,h);
    ctx.font = '12px Arial';
    for(let i=0;i<values.length;i++){
      const val = values[i]; const bh = (val/max) * (h - 30); const x = 10 + i*barW; const y = h - bh - 20;
      ctx.fillStyle = 'rgba(0,183,255,0.9)'; ctx.fillRect(x,y,barW*0.7,bh);
      ctx.fillStyle = getComputedStyle(document.body).getPropertyValue('--muted').trim() || '#7f8c93';
      ctx.fillText(String(val), x, y - 6);
      const short = days[i].slice(5);
      ctx.fillText(short, x, h - 4);
    }
  }

  function escapeHtml(s){ return (s||'').toString().replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

  // events delegation
  document.addEventListener('click', e=>{
    const btn = e.target.closest('button');
    if(!btn) return;
    const id = btn.dataset.id, action = btn.dataset.action;
    if(action === 'toggle'){ const r = state.routines.find(x=>x.id===id); if(r){ r.done = !r.done; maybePlaySound('beep'); notify('[Daily] '+r.name, 'Marked ' + (r.done ? 'completed' : 'pending')); saveState(); render(); checkAllDone(); } }
    if(action === 'del'){ state.routines = state.routines.filter(x=>x.id!==id); saveState(); render(); }
    if(action === 'edit'){ const r = state.routines.find(x=>x.id===id); if(r){ const name = prompt('Edit name', r.name); const time = prompt('Edit time (HH:MM)', r.time); if(name) r.name = name; if(time) r.time = time; saveState(); render(); } }
    if(action === 'toggleHabit'){ const h = state.habits.find(x=>x.id===id); if(h){ h.done = !h.done; if(h.done){ h.streak = (h.streak||0)+1; recordWeekly(); } else { h.streak = Math.max(0,(h.streak||0)-1); } updateLongest(); saveState(); render(); checkAllDone(); } }
    if(action === 'delHabit'){ state.habits = state.habits.filter(x=>x.id!==id); saveState(); render(); }
    if(action === 'editHabit'){ const h = state.habits.find(x=>x.id===id); if(h){ const name = prompt('Edit habit name', h.name); const rem = prompt('Daily reminder time (HH:MM) or leave blank', h.reminder||''); if(name) h.name = name; h.reminder = rem||''; saveState(); render(); } }
  });

  // UI controls
  document.getElementById('addRoutineBtn').addEventListener('click', ()=>{
    const name = prompt('Routine name'); const time = prompt('Time (HH:MM)'); if(!name||!time) return; state.routines.push({id: uid(), time, name, repeat:'once', done:false}); saveState(); render();
  });

  document.getElementById('clearDoneBtn').addEventListener('click', ()=>{ state.routines = state.routines.filter(r=>!r.done); saveState(); render(); });

  document.getElementById('saveRoutine').addEventListener('click', ()=>{
    const name = document.getElementById('routineName').value.trim(); const time = document.getElementById('routineTime').value; const repeat = document.getElementById('routineRepeat').value;
    if(!name||!time) return alert('Enter name and time');
    state.routines.push({id:uid(), time, name, repeat, done:false});
    document.getElementById('routineName').value=''; saveState(); render();
  });

  document.getElementById('addHabitBtn').addEventListener('click', ()=>{
    const v=document.getElementById('newHabitInput').value.trim(); const rem=document.getElementById('habitReminderTime').value;
    if(!v) return; state.habits.push({id:uid(), name:v, done:false, streak:0, reminder: rem||''}); document.getElementById('newHabitInput').value=''; document.getElementById('habitReminderTime').value=''; saveState(); render();
  });

  document.getElementById('exportBtn').addEventListener('click', ()=>{
    const data = JSON.stringify(state,null,2); const blob = new Blob([data],{type:'application/json'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='daily-export.json'; a.click(); URL.revokeObjectURL(url);
  });

  document.getElementById('importBtn').addEventListener('click', async ()=>{
    const txt = prompt('Paste exported JSON'); if(!txt) return; try{ const parsed = JSON.parse(txt); state = parsed; saveState(); render(); }catch(e){ alert('Invalid JSON'); }
  });

  document.getElementById('soundTest').addEventListener('click', ()=> maybePlaySound('chime'));

  // notifications toggle + sound select (keeps simple)
  document.getElementById('notificationsToggle')?.addEventListener('change', async (e)=>{
    state.settings.notifications = e.target.checked; saveState();
    if(e.target.checked){ if('Notification' in window && Notification.permission !== 'granted'){ await Notification.requestPermission(); } }
  });
  document.getElementById('soundSelect')?.addEventListener('change', (e)=>{ state.settings.sound = e.target.value; saveState(); });

  // install prompt handling
  let deferredPrompt = null;
  window.addEventListener('beforeinstallprompt',(e)=>{ e.preventDefault(); deferredPrompt = e; document.getElementById('installBtn').style.display='inline-block'; });
  document.getElementById('installBtn').addEventListener('click', async ()=>{ if(deferredPrompt){ deferredPrompt.prompt(); const res = await deferredPrompt.userChoice; deferredPrompt = null; document.getElementById('installBtn').style.display='none'; } });

  // sounds: unlock on user gesture
  function unlockAudioOnUserGesture(){
    const btn = document.getElementById('soundUnlockBtn');
    btn.addEventListener('click', ()=>{
      Object.values(soundMap).forEach(id=>{
        const el = document.getElementById(id);
        if(el){ el.play().then(()=>{ el.pause(); el.currentTime = 0; }).catch(()=>{}); }
      });
      btn.textContent = 'Sound Enabled';
      btn.disabled = true;
      // also set default sound if not present
      if(!state.settings.sound) state.settings.sound = 'chime';
      saveState();
    }, { once:true });
  }
  unlockAudioOnUserGesture();

  function maybePlaySound(kind){
    const s = kind || state.settings.sound || 'chime';
    if(s === 'none') return;
    const el = document.getElementById(soundMap[s] || soundMap.chime);
    if(!el) return;
    el.currentTime = 0;
    el.play().catch(()=>{ /* play blocked until user interacts */ });
  }

  function notify(title, body){
    if(!state.settings.notifications) return;
    if('Notification' in window && Notification.permission === 'granted'){
      try{ new Notification(title, { body }); }catch(e){}
    }
  }

  // schedule checker
  setInterval(checkSchedules, 20 * 1000);
  checkSchedules();
  function checkSchedules(){
    const now = new Date(); const cur = now.toTimeString().slice(0,5); const dow = now.getDay();
    state.routines.forEach(r=>{
      if(r._lastTriggered === cur) return;
      let active = true;
      if(r.repeat === 'weekdays' && (dow === 0 || dow === 6)) active = false;
      if(!active) return;
      if(r.time === cur && !r.done){
        r._lastTriggered = cur;
        notify('[Daily] ' + r.name, 'Time: ' + r.time);
        maybePlaySound('beep');
      }
    });
    state.habits.forEach(h=>{
      if(!h.reminder) return;
      if(h._lastRem === cur) return;
      if(h.reminder === cur && !h.done){
        h._lastRem = cur;
        notify('[Daily] Habit: ' + h.name, 'Reminder at ' + h.reminder);
        maybePlaySound('beep');
      }
    });
  }

  // midnight rollover
  function checkMidnight(){
    const today = todayStr();
    if(state.meta.lastDate !== today){
      // store previous day summary
      const prevDate = state.meta.lastDate;
      state.meta.history[prevDate] = {
        routines: state.routines.map(r=>({ name: r.name, time: r.time, done: r.done })),
        habits: state.habits.map(h=>({ name: h.name, done: h.done, streak: h.streak || 0 })),
        completedCount: state.routines.filter(r=>r.done).length,
        totalRoutines: state.routines.length,
        habitsDone: state.habits.filter(h=>h.done).length
      };
      // reset
      state.meta.lastDate = today;
      state.routines.forEach(r=> r.done = false);
      state.habits.forEach(h=>{ if(!h.done) h.streak = 0; h.done = false; });
      updateLongest(); saveState(); render();
    }
  }
  setInterval(checkMidnight, 60 * 1000);
  checkMidnight();

  // streak + weekly
  function recordWeekly(){ const d=todayStr(); state.meta.weekly[d] = (state.meta.weekly[d]||0) + 1; saveState(); }
  function updateLongest(){ const s = state.habits.reduce((m,h)=>Math.max(m,h.streak||0),0); state.meta.longestStreak = Math.max(state.meta.longestStreak||0,s); saveState(); }

  function checkAllDone(){
    const all = state.routines.length>0 && state.routines.every(r=>r.done);
    if(all){
      maybePlaySound('success'); spawnConfetti(); notify('[Daily] All Done!', 'You completed all routines â€” great job ðŸŽ‰');
    }
  }

  // quotes (small)
  const quotes = ["Small habits make big changes.","Consistency beats intensity.","Start small â€” build momentum.","1% better every day.","Progress, not perfection."];
  function loadQuotes(force=false){
    const qEl = document.getElementById('quote');
    if(!qEl) return;
    if(!force){ const idx = (new Date().getDate() + new Date().getMonth()) % quotes.length; qEl.textContent = quotes[idx]; }
    else qEl.textContent = quotes[Math.floor(Math.random()*quotes.length)];
  }
  loadQuotes();

  // confetti
  const confettiCanvas = document.getElementById('confetti');
  const confettiCtx = confettiCanvas.getContext('2d');
  function resizeConfetti(){ confettiCanvas.width = window.innerWidth; confettiCanvas.height = window.innerHeight; }
  window.addEventListener('resize', resizeConfetti); resizeConfetti();
  let confettiPieces = [], confettiRunning=false;
  function spawnConfetti(){
    confettiPieces=[]; for(let i=0;i<120;i++) confettiPieces.push({ x: Math.random()*confettiCanvas.width, y: Math.random()*-confettiCanvas.height, r:(Math.random()*6)+4, d: Math.random()*40+10, color:`hsl(${Math.random()*360},70%,60%)`, tilt: Math.random()*10 });
    animateConfetti();
  }
  function animateConfetti(){
    if(confettiRunning) return; confettiRunning=true;
    const loop = ()=>{
      confettiCtx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
      for(let i=0;i<confettiPieces.length;i++){
        const p=confettiPieces[i];
        p.y += Math.sqrt(p.d)+1; p.tilt += 0.1;
        confettiCtx.fillStyle = p.color;
        confettiCtx.beginPath();
        confettiCtx.ellipse(p.x + p.tilt, p.y, p.r, p.r*0.6, p.tilt, 0, Math.PI*2);
        confettiCtx.fill();
      }
      confettiPieces = confettiPieces.filter(p=>p.y < confettiCanvas.height + 50);
      if(confettiPieces.length>0) requestAnimationFrame(loop); else { confettiRunning=false; confettiCtx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height); }
    };
    loop();
  }

  // Tabs
  document.querySelectorAll('.tab').forEach(t=>{
    t.addEventListener('click', ()=>{
      document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
      t.classList.add('active');
      const tab = t.dataset.tab;
      document.getElementById('homePage').style.display = tab==='home' ? '' : 'none';
      document.getElementById('summaryPage').style.display = tab==='summary' ? '' : 'none';
      render();
    });
  });
  document.getElementById('backHomeBtn')?.addEventListener('click', ()=>{ document.querySelector('.tab[data-tab="home"]').click(); });

  // export summary
  document.getElementById('exportSummaryBtn')?.addEventListener('click', ()=>{
    const date = todayStr();
    const summary = state.meta.history[date] || { routines: state.routines.map(r=>({name:r.name,time:r.time,done:r.done})), habits: state.habits.map(h=>({name:h.name,done:h.done,streak:h.streak})) };
    const blob = new Blob([JSON.stringify(summary,null,2)], {type:'application/json'}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = `daily-summary-${date}.json`; a.click(); URL.revokeObjectURL(url);
  });

  // keyboard
  document.addEventListener('keydown', e=>{ if((e.ctrlKey||e.metaKey) && e.key.toLowerCase()==='n'){ e.preventDefault(); document.getElementById('routineName').focus(); } });

  // init UI actions
  document.getElementById('soundTest').addEventListener('click', ()=> maybePlaySound('beep'));

  // manifest + SW (blobs)
  (function createManifestBlob(){
    try{
      const manifest = { name:"Daily", short_name:"Daily", start_url:"./index.html", display:"standalone", background_color:"#000000", theme_color:"#000000", icons:[{ src:"data:image/svg+xml;base64," + btoa(`<svg xmlns='http://www.w3.org/2000/svg' width='192' height='192'><rect width='100%' height='100%' rx='32' fill='#00f5a0'/><text x='50%' y='54%' dominant-baseline='middle' text-anchor='middle' font-family='Arial' font-size='70' fill='#001018'>D</text></svg>`), sizes:"192x192", type:"image/svg+xml" }]};
      const blob = new Blob([JSON.stringify(manifest)], {type:'application/json'}); const url = URL.createObjectURL(blob); const link = document.createElement('link'); link.rel='manifest'; link.href=url; document.head.appendChild(link);
    }catch(e){}
  })();

  (function registerSWFromBlob(){
    if('serviceWorker' in navigator){
      const swCode = `
        const CACHE='daily-amoled-v1';
        const assets=['./index.html'];
        self.addEventListener('install', e=>{ self.skipWaiting(); e.waitUntil(caches.open(CACHE).then(c=>c.addAll(assets)).catch(()=>{})); });
        self.addEventListener('activate', e=>{ e.waitUntil(self.clients.claim()); });
        self.addEventListener('fetch', e=>{ e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request)).catch(()=>fetch(e.request))); });
      `;
      const blob = new Blob([swCode], {type:'text/javascript'}); const swUrl = URL.createObjectURL(blob);
      navigator.serviceWorker.register(swUrl).then(()=>console.log('SW registered')).catch(()=>{});
    }
  })();

  // load & initial render
  render();

  // utility small functions
  function recordWeekly(){ const d=todayStr(); state.meta.weekly[d] = (state.meta.weekly[d]||0) + 1; saveState(); }
  function updateLongest(){ const s = state.habits.reduce((m,h)=>Math.max(m,h.streak||0),0); state.meta.longestStreak = Math.max(state.meta.longestStreak||0,s); saveState(); }

  // simple toast (console fallback)
  function showToast(msg){ console.log('Toast:', msg); }
    // Resize chart dynamically
function resizeChart(){
  const chartCanvas = document.querySelector('#chart'); // or your chart ID
  if(!chartCanvas) return;
  chartCanvas.width = chartCanvas.parentElement.clientWidth - 20;
  chartCanvas.height = 120; // or keep dynamic if needed
  renderChart(); // call your existing render function
}
window.addEventListener('resize', resizeChart);
resizeChart();

// Resize confetti canvas
function resizeConfetti(){ 
  const confettiCanvas = document.querySelector('#confetti'); // your confetti canvas ID
  if(!confettiCanvas) return;
  confettiCanvas.width = window.innerWidth; 
  confettiCanvas.height = window.innerHeight; 
}
window.addEventListener('resize', resizeConfetti); 
resizeConfetti();


  </script>
</body>
</html>




